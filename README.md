# 車割自動作成マクロ

## 概要
行きと帰りの人数、時間、場所、運転手の情報から、自動的に車割（誰がどの車に乗るか）を決定するExcelマクロです。

**v1.1の新機能:**
- ✨ 統計情報の自動表示（総台数、総人数、運転可能人数、平均乗車人数）
- 📊 完了メッセージに概要情報を表示
- 💾 CSV形式でエクスポート機能（オプション）

## 必要な環境
- Microsoft Excel（Windows版推奨）
- マクロを有効にする必要があります

## 使い方

### 1. Excelファイルの準備

新しいExcelファイルを開き、2つのシートを用意します:

#### シート1: 「メンバー情報」
以下の列を作成してください（A列から順に）:

| A列 | B列 | C列 | D列 | E列 | F列 | G列 | H列 |
|-----|-----|-----|-----|-----|-----|-----|-----|
| 名前 | 行き日 | 行き時 | 行き場所 | 帰り日 | 帰り時 | 帰り場所 | 運転可 |

- **行き日/帰り日**: `11/1` の形式
- **行き時/帰り時**: `夜`、`朝`、`昼前`、`夕方` など
- **運転可**: `○` または `×`

#### シート2: 「車割結果」
このシートは空のままでOKです。マクロが自動で結果を出力します。

### 2. マクロのインストール

1. Excel で `Alt + F11` を押して VBA エディタを開く
2. メニューから「挿入 (Insert)」→「モジュール (Module)」を選択
3. `KurumawariMacro.bas` の内容を**全て**コピー＆ペースト
4. VBA エディタを閉じる（`Alt + Q`）
5. ファイルを「Excelマクロ有効ブック (.xlsm)」形式で保存

### 3. マクロの実行

1. Excelの「開発」タブを表示（表示されていない場合は、ファイル→オプション→リボンのユーザー設定で「開発」にチェック）
2. 「開発」タブ→「マクロ」をクリック
3. `GenerateKurumawari` を選択して「実行」

または、ショートカットキーを設定することもできます:
- マクロ一覧で `GenerateKurumawari` を選択
- 「オプション」ボタンをクリック
- ショートカットキー（例: `Ctrl + Shift + K`）を設定

### 4. 結果の確認

「車割結果」シートに以下の形式で出力されます:

| 日 | 時 | 場所 | 運転手 | 同乗者1 | 同乗者2 | 同乗者3 | 同乗者4 |
|----|-----|------|--------|---------|---------|---------|---------|

さらに、シートの下部に統計情報が表示されます:
- 総台数
- 総人数
- 運転可能人数
- 平均乗車人数

### 5. CSV形式でエクスポート（オプション）

結果をCSVファイルとして保存したい場合:
1. 「開発」タブ → 「マクロ」
2. `ExportToCSV` を選択して「実行」
3. 保存場所とファイル名を指定

## マクロの仕様

### 基本ルール
1. **1台あたり最大5人**（運転手1人 + 同乗者4人）
2. **同じ日時・場所でグループ化**
3. **運転可能な人を優先的に運転手に配置**
4. **できるだけ車の台数を最小化**

### アルゴリズム
1. 行きと帰りを別々に処理
2. 日時・場所ごとにメンバーをグループ化
3. 各グループ内で:
   - 運転可能な人数をカウント
   - 必要な車の台数を計算（5人/台）
   - 運転手を均等に割り当て
   - 残りのメンバーを各車に振り分け

## トラブルシューティング

### マクロが実行できない
- Excelのセキュリティ設定を確認
- 「ファイル」→「オプション」→「セキュリティセンター」→「セキュリティセンターの設定」
- 「マクロの設定」で「警告を表示してすべてのマクロを無効にする」を選択

### エラーが出る
- シート名が正しいか確認（「メンバー情報」「車割結果」）
- 列の順序が正しいか確認
- データに空白行がないか確認
- 日付の形式が正しいか確認（例: `11/1`）

### 結果が期待と違う
- 運転可能な人数が十分か確認
- 同じ日時・場所のグループ分けが正しいか確認

## カスタマイズ

`KurumawariMacro.bas` を編集することで、以下をカスタマイズできます:
- 1台あたりの最大乗車人数（デフォルト: 5人）
- 同乗者の列数（デフォルト: 4人）
- シート名

## バージョン履歴
- v1.1 (2025/11/02) - 統計情報表示機能、CSVエクスポート機能を追加
- v1.0 (2025/11/02) - 初版リリース
